<?xml version="1.0"?>

<robot xmlns:xacro="http://www.ros.org/wiki/xacro">


	<!-- Things that are needed only for Gazebo (not the physical robot). These include sensor and controller plugin specifications -->
	<xacro:include filename="$(find hyl_description)/urdfs/leg/leg.transmission.xacro"/>
	<xacro:include filename="$(find hyl_description)/urdfs/leg/leg.gazebo.xacro"/>


	<!-- ================================== Leg ================================== -->
	<!-- The xacro macro xacro:hyl_leg contains: slider upper and lower leg -->
	<xacro:macro name="hyl_leg" params="name parent *origin reflect_upper reflect_front">

		<!-- Joints -->
		<!-- Slider joint -->
		<joint name="slider_z_joint" type="prismatic">
			<insert_block name="origin"/>
			<parent link="${parent}"/>
			<child  link="slider"/>
			<limit effort="1000.0" velocity="1.0" lower="-0.1" upper="0.1"/>
			<axis xyz="0 0 1"/>
			<dynamics damping="0.1" friction="0" />
			<safety_controller k_position="100" k_velocity="100" soft_lower_limit="-10" soft_upper_limit="12.45" />
		</joint>
		<!-- Hip assembly joint -->
		<joint name="${name}_assembly_joint" type="fixed">
			<origin xyz="0 ${-d_lr/2} 0" rpy="0 ${PI/2} ${PI}"/>
			<parent link="slider"/>
			<child  link="${name}_assembly"/>
		</joint>
		<!-- Virtual hip joint assembly -->
		<joint name="${name}_haa_joint" type="revolute">
			<origin xyz="0 0 0" rpy="0 0 0"/> 
			<parent link="${name}_assembly"/>
			<child  link="${name}_virtual_assembly"/>
			<limit effort="200.0" velocity="1000.0" lower="${-PI/2}" upper="${PI/6}"/>
			<axis xyz="0 0 1"/>
			<dynamics damping="0.1" friction="0" />
			<safety_controller k_position="100" k_velocity="100" soft_lower_limit="-10" soft_upper_limit="12.45" />
		</joint>
		<!-- Upper leg joint -->
		<joint name="${name}_hfe_joint" type="revolute">
			<origin xyz="${d_tbb} 0.0 0.0" rpy="${reflect_upper*PI/2} ${-1*hfe_pos0} 0.0"/>
			<parent link="${name}_assembly"/>
			<child  link="${name}_upper_leg"/>
			<limit effort="200.0" velocity="1.0" lower="${-(1+reflect_front)*5*PI/36-(1-reflect_front)*7*PI/36-reflect_front*hfe_pos0}" upper="${(1-reflect_front)*5*PI/36+(1+reflect_front)*7*PI/36-reflect_front*hfe_pos0}"/>
			<axis xyz="0 0 1"/>
			<dynamics damping="0.1" friction="0" />
			<safety_controller k_position="100" k_velocity="100" soft_lower_limit="-10" soft_upper_limit="12.45" />
		</joint>
		<!-- Lower leg joint -->
		<joint name="${name}_kfe_joint" type="revolute">
			<origin xyz="${d_p1p2} 0.0 0.0" rpy="0.0 0.0 ${reflect_front*kfe_pos0}"/>
			<parent link="${name}_upper_leg"/>
			<child  link="${name}_lower_leg"/>
			<limit effort="200.0" velocity="1.0" lower="${-(1+reflect_front)*7*PI/18+(1-reflect_front)*PI/18-reflect_front*kfe_pos0}" upper="${(1-reflect_front)*7*PI/18-(1+reflect_front)*PI/18-reflect_front*kfe_pos0}"/>
			<axis xyz="0 0 1"/>
			<dynamics damping="0.1" friction="0" />
			<safety_controller k_position="100" k_velocity="100" soft_lower_limit="-10" soft_upper_limit="12.45" />
		</joint>
		<!-- Foot joint -->
		<joint name="${name}_foot_joint" type="fixed">
			<origin xyz="0.34 0.0 0.0" rpy="${PI/2} 0.0 ${-PI/2}"/>
			<parent link="${name}_lower_leg"/>
			<child  link="${name}_foot"/>
		</joint>


		<!-- Links -->
		<!-- Slider link -->
		<link name="slider">
			<inertial>
				<origin xyz="0.0 0.0 0.0"/>
				<mass value="0.01"/>
				<inertia ixx="0.01" iyy="0.01" izz="0.01" ixy="0.0" ixz="0.0" iyz="0.0"/>
			</inertial>
		</link>
		<!-- Hip assembly link -->
		<link name="${name}_assembly">
			<inertial>
				<origin xyz="0.0 0.0 0.0"/>
				<mass value="0.01"/>
				<inertia ixx="0.01" iyy="0.01" izz="0.01" ixy="0.0" ixz="0.0" iyz="0.0"/>
			</inertial>
		</link>
		<!-- Virtual hip assembly link -->
		<link name="${name}_virtual_assembly">
			<inertial>
				<origin xyz="0.0 0.0 0.0"/>
				<mass value="0.01"/>
				<inertia ixx="0.01" iyy="0.01" izz="0.01" ixy="0.0" ixz="0.0" iyz="0.0"/>
			</inertial>
		</link>
		<!-- Upper leg link -->
		<link name="${name}_upper_leg">
			<inertial>
				<origin xyz="0.14796 ${reflect_upper*0.02958} 0.0"/>
				<mass value="${m_upper}"/>
				<inertia ixx="${ixx_upper}" iyy="${iyy_upper}" izz="${izz_upper}" ixy="${ixy_upper}" ixz="${ixz_upper}" iyz="${iyz_upper}"/>
			</inertial>
			<visual> 
				<origin xyz="0.0 0.0 0.0" rpy="${(1-reflect_front)*PI/2} 0.0 0.0"/>
				<geometry>
					<mesh filename="package://hyl_description/meshes/leg/upper.dae" scale="1 1 1"/>
				</geometry>
			</visual>
			<collision>
				<origin xyz="0.0 0.0 0.0" rpy="${(1-reflect_front)*PI/2} 0.0 0.0"/>
				<geometry>
					<mesh filename="package://hyl_description/meshes/leg/upper.dae" scale="1 1 1"/>
				</geometry>
			</collision>
		</link>
		<!-- Lower leg link -->
		<link name="${name}_lower_leg">
			<inertial>
				<origin xyz=" 0.17830  0.00030 -0.00010"/>
				<mass value="${m_lower}"/>
				<inertia ixx="${ixx_lower}" iyy="${iyy_lower}" izz="${izz_lower}" ixy="${ixy_lower}" ixz="${ixz_lower}" iyz="${iyz_lower}"/>
			</inertial>
			<visual>
				<geometry>
					<mesh filename="package://hyl_description/meshes/leg/lower.dae" scale="1 1 1"/>
				</geometry>
				<material name="white"/>
			</visual>
			<collision>
				<geometry>
					<mesh filename="package://hyl_description/meshes/leg/lower.dae" scale="1 1 1"/>
				</geometry>
			</collision>
		</link>
		<!-- Foot link -->
		<link name="${name}_foot">
			<inertial>
				<origin xyz="0.0 0.0 0.0"/>
				<mass value="0.01"/>
				<inertia ixx="0.0" iyy="0.0" izz="0.0" ixy="0.0" ixz="0.0" iyz="0.0"/>
			</inertial>
			<visual>
				<origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
<!--				<geometry>
					<sphere radius="0.021"/>
				</geometry>-->
			</visual>
			<collision>
				<origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
				<geometry>
					<sphere radius="0.02175"/>
				</geometry>
			</collision>
		</link>
		
		<!-- Extensions -->
		<xacro:leg_transmission name="${name}"/>
		<xacro:leg_gazebo name="${name}"/>
	</xacro:macro>

</robot>
